v3.6.0
======

Morpheus v3.6 promotes v3.5 to a LTS branch. v3.6.0 contains everything in 3.5.3, please refer to all 3.5 release notes when upgrading from the 3.4 LTS branch to v3.6.

.. note:: If upgrading from 3.5.2 or earlier, yum and msi agent package requests are now over port 443 instead of 80. 80 is still required for apt packages.

.. important:: If upgrading from 3.5.2 or earlier, ngnix needs to be restarted after 3.5.3 upgrade with ``morpheus-ctl restart nginx`` to accommodate yum and msi agent installs over 443

Release date:

New Features
------------

- Agent: Morpheus Windows Agent can now install over Guest Customizations (via unattend) or Cloudbase-Init
- Agent: Morpheus Windows Agent v1.4.4
- Ansible: `Ansible execution over command bus`_ added. Morpheus has removed the need for ssh or winrm for Ansible!
- Ansible: `Ansible verbose logging mode`_ added
- API & CLI: Billing Data now contains server ID & external ID
- API/CLI - `Mute and Unmute Monitoring Checks now from CLI & API`_
- Appliance: Check server agent TLS support for RabbitMQ connection
- Appliance: Check server agent TLS support for RabbitMQ connection added
- Apps: App Tiered provisioning can now handle much longer provisioning workloads
- Automation: Added Post Provision phase output to Instance history for Workflows, Tasks and Scripts
- AWS: Clouds can now be scoped to all VPCs in a region instead of a single VPC per region
- `AWS: Costing & Reservations sync`_: |morpheus| now syncs in AWS costs and EC2 Reservations from AWS.
- AWS: New Summary Tab added to AWS Cloud detail pages containing cost and EC2 Reservation statistics.
- Azure: Resource Pool creation and removal added
- Backups: Backup archives on failures are now automatically cleaned up
- Clouds: `Disable Clouds now filtered`_ in Instance, App, Host, Migration and Blueprint wizards
- Clouds: `Huawei Cloud integration added`_
- DISA Compliance: sudoers.d via cloud-init no longer adds users with NOPASSWD flag in
- Google Cloud: Windows support added
- Google: Multi-network support added for Google Instances
- Infrastructure: VMs & Hosts: Version and Layout selection added to Convert to Managed
- Instances: ``Run Task`` Instance Action added. Allows executing individual tasks on Instances
- Instances: `Long Instance and Host names now wrap`_ in list view
- Isilon: `NFS mount path for Isilon volumes`_ displayed in Isilon tab
- KVM: Import Image: Added ability to import a KVM virtual machine image from both a managed and unmanaged KVM cloud. Supports both CEPH and LVM
- Policies: New `File Share Storage Quotas`_ and `Object Storage Quotas`_ policy types added.
- Policies: New Policy Icons
- Policies: User Group Creation Policy Type added
- Remedy: Remedy Integrations now support Approval Policies for Provisioning and Lifecycle extension Approvals in Remedy.
- Remedy: Tenant and User added to main asset
- Rubrik: SLA Domains added to instance detail backup tab and backup details
- SCVMM : Do not require cloud selection for SCVMM clouds
- SCVMM : Use agent for communication rather than winrm
- Storage Servers: Tenancy Visibility setting added for Dell EMC Isilon and ECS Storage Servers
- Terraform: HCL4j parser updated to handle 100% coverage of terraform syntax formats
- TerraForm: Reapply Wizard added to Terraform Apps
- Usage: Added usage tracking for changes to Discovered resource sizes for VM's in VMware vCenter and Nutanix Cloud types
- VMware: Keyboard layout selection added to VMware vCenter cloud types for Console
- ARM Templates: Fix for conditional 'if(..)' statements breaking ARM apps

AWS: Costing & Reservations sync
................................

Morpheus now syncs in actual costs from AWS, including Month To Date, estimated spend, last months costs, broken down by service, including On-Demand and Reserved hours per EC2 Instance Type.

.. image:: /images/infrastructure/clouds/aws/3_6_0_aws_cost_res.jpeg


Ansible execution over command bus
..................................

Morpheus has removed the need for ssh or winrm for Ansible! The new Ansible execution over command bus feature allows running ansible over the |morpheus| agent command bus, removing the need for an ssh or winrm connection for Ansible, or any open incoming ports on the target host. The Morpheus Agent (which can be installed with no open incoming ports on the target vm/host as well) will pull and execute Ansible commands locally.

To enable Ansible execution over the |morpheus| agent command bus, edit you Ansible integration and select " Use Morpheus Agent Command Bus"

.. image:: /images/provisioning/automation/ansible/3_6_0_Ansible_Command_Bus

Ansible verbose logging mode
............................

When using Ansible execution over the Morpheus Agent command bus, verbose debug logging can be enabled but editing an Ansible Integration. Along with the "Use Morpheus Agent Command Bus" flag, "Enable Verbose Logging" is a new setting on Ansible integration settings that will output debug level logs for Ansible execution, visible in the Instance history section by selection the "i" bubble on an executed Ansible task.


.. image:: /images/provisioning/automation/ansible/3_6_0_ansible_verbose_logging_flag

File Share Storage Quotas
.........................

The new File Share Storage Quotas Policy type allows, you guessed it, setting Storage Quotas for File Shares.

To add, in ``Administration -> Policies`` add a new Policy, and select ``File Share Storage Quota``.

.. image:: /images/provisioning/automation/ansible/3_6_0_policies_file_share_quota_config



Then set the Name, give it a good description, set the size in GB, and scope it Globally or to a User.

.. image:: /images/provisioning/automation/ansible/3_6_0_policies_file_share_quota_select


Object Storage Quotas
......................

The new Object Storage Quotas Policy type allows, you guessed it, setting Storage Quotas for Object Stores.

To add, in ``Administration -> Policies`` add a new Policy, and select ``Object Storage Quota``.

.. image:: /images/provisioning/automation/ansible/3_6_0_policies_object_storage_quota_select



Then set the Name, give it a good description, set the size in GB, and scope it Globally or to a User.

.. image:: /images/provisioning/automation/ansible/3_6_0_policies_object_storage_quota_config


Disable Clouds now filtered
...........................

Previously, deselecting "Enabled" in a Clouds configuration settings only disabled sync and greyed it out in the Clouds list view. Now disabled clouds are filtered out/hidden in Instance, App, Host, Migration and Blueprint wizards.

.. NOTE:: If you disable a cloud to temporarily pause sync, be sure to re-enable it for provisioning.


Long Instance and Host names now wrap
.....................................

Instance and Host list pages now wrap long Instance and Host names, allowing for viewing the entirety of a long Instance or Host name without having to select or hover.

.. image:: /images/provisioning/automation/ansible/3_6_0_name_wrap

Huawei Cloud integration added
..............................

Huawei Cloud now available as a Cloud integration in Morpheus v3.6.0.

images/provisioning/automation/ansible/3_6_0_huawei

NFS mount path for Isilon volumes
..................................

The path to fileshare is now displayed on the Isilon tab to make it easier for users to know how to mount the share in a VM

.. image:: /images/infrastructure/Storage/3_6_0_isilon_share_path.png

Mute Monitoring Checks from CLI & API
......................................

.. code-block:: bash

   Usage: morpheus monitor-checks mute [name]
   Usage: morpheus monitor-groups mute [name]
   Usage: morpheus monitor-apps mute [name]

    Mute a check, check group, or monitoring app. This prevents it from creating new incidents.
    [name] is required. This is the name or id of a check.
      --disable can be passed to disable mute state instead, the same as unmute

   Usage: morpheus monitor-checks mute-all
   Usage: morpheus monitor-groups mute-all
   Usage: morpheus monitor-apps mute-all

    Mute all checks. This prevents the creation new incidents.
      --disable can be passed to disable mute state instead, the same as unmute

   Usage: morpheus monitor-incidents mute-all


   Usage: morpheus monitor-checks unmute [name]

      Unmute a check.
      [name] is required. This is the name or id of a check.












Bug Fixes
----------

<<<<<<< HEAD
- Active Directory: Fix for user accounts locking during login because of perceived failed login attempts
- Administration: Fix for tenant delete issue when a master tenant service plan is assigned to the sub-tenant
- API/CLI: Fix for updating user role multitenant flag
- API/CLI: Fix for updating cloud access settings in roles
- API/CLI: Fix for |morpheus| push API checks
- API/CLI: Fix for Create App not handling JSON parameters (description & site ID)
- API/CLI: Fix for history API query filters not working
- API/CLI: Fix for API processes history for appId query
- API/CLI: Fix for creating a security group rule not persisting instanceTypeId
- API/CLI: Fix for creating a restart task on CLI
- API/CLI: Fix for API/CLI network creation
- Apps: Fix for instance configuration getting reset when using "previous" in the app wizard
- Archive: Fix for |morpheus| user session timeout during large file upload
- Backups: Updated backup message in Admin - Backups when backups are disabled
- Blueprint: Fix for tier order display in multi tier blueprint
- Blueprint: Fix for exposed ports not being lockable
- Blueprint: Fix for volume size field responsiveness
- Clouds: Fix for |morpheus| IP-pool ranges being deleted when a cloud with associated network is deleted
- Clouds: Fix for Open Telekom Cloud router & network creation
- Clouds: Fix for AWS security group subtenant visibility
- Custom Library: Fix for instance wizard not allowing a custom library item for oracleVM
- Custom Library: Fix for Sub-Tenants role permissions for custom instance types when tenant role Instance Type Access is set to Global:Custom
- Groups: Fix for User Group deletion when user group is associated with existing instances
- Hosts: Fix for Docker & Kubernetes hosts not deployable on VIO
- Hosts: Fix for Ubuntu Docker hosts DNS name servers being removed on reboot
- Instances: Fix for multi-select convert to managed not having group selection
- Instances: Fix for start/stop service on instance list showing when not applicable
- Instances: Fix for reconfiguring VM/Host not adding new usage record
- Instances: Fix for not being able to clone Windows instance
=======
- ? Active Directory: Fix for user accounts locking during login //? in what circumstances
- ? Administration: Fix for error when deleting subtenant //? which error
- ? API/CLI: Fix for multitenant error ? //which error
- ? API/CLI: Fix for role update to allow cloud access via CLI fails //? makes no sense, reword
- ? API/CLI: Fix for Morpheus push API checks ?//what was the issue?
- API/CLI: Fix for Create App not handling description & site ID JSON parameters
- API/CLI: Fix for history API query filters not working
- ? API/CLI: Fix for API processes for appId //? need more info
- ? API/CLI:  Fix for create a security group rule not persisting instanceTypeId //reword
- ? API/CLI: Fix for creating a restart task on CLI giving an error //reword
- ? API/CLI: Fix for API/CLI execution failure to create networks //reword
- ? Apps: Fix for instance configuration getting reset during app wizard //when?
- Archive: Fix for morpheus user session timeout during large file upload
- ? ARM Templates: Fix for conditional 'if(..)' statements breaking ARM apps // reword to added support for
- ? Backups: Fix for appliance backup message in Admin //?what message
- ? Blueprint: Fix for reordered tiers for multi tier blueprint //?reword to make sense
- ? Blueprint: Fix for exposed ports not being lockable
- ? Blueprints:  Fix for volume size issue with responsiveness //?what issue?
- ? Clouds: Fix for deleting cloud removes IP-pool range //reword to make sense with more detail
- ? Clouds:  Fix for Open Telekom Cloud router & networks created disappear and do not get populated onto the Open Telekom Cloud //reword to make sense

Can we run through the rest and use proper grammar and explain what the issue was please?

- Cloud: Fix for assigning AWS Cloud to subtenant showing no security groups
- Custom Library:  Fix for instance wizard won't allow provisioning a custom library item for oracleVM
- Custom Library Items: Fix for Sub-Tennant are unable to use custom library items from instance creation wizard.  When the account/tenant instance type is set to custom
- Groups: Fix for User Group not getting deleted when associated to instances or servers
- Host: Fix for Docker & Kubernetes hosts not deployable on VIO
- Hosts: Fix for Ubuntu Docker hosts name servers removed after a reboot
- Instances: Fix for instance powering off instead of shutting down
- Instances:  Fix for multi-select convert to managed has no group selection
- Instances: Hid start / stop service on instance list when not applicable
- Instances:  Fix for reconfigure VM/Host not adding usage record
- ? Instances:  Fix for cannot clone Windows instance
>>>>>>> 9e33240c228bbe60395f46571faffdb788716791
- Instances: Fix for sub nav bar not appearing when clicking app link in instance detail page
- Instances  Fix for Plan/Resource change detected when altered on cloud (not creating new usage records)
- Images: Fix for images being larger than selected plan
- Images: Fix for seeded CentOS 7.2 & 7.3 Docker system images
- Images: Fix for GPS images incorrect labeling
- Load Balancer: Fix for AVI fields missing in LB provisioning wizard
- Networking: Fix for not being able to create NSX edge gateway
- Nutanix: Fix for Windows hostnames being counted/truncated
- OCI: Fix for regions not working properly
- Openstack: Fix for wrong plan tied being to instance
- Pricing: Fix for cloud not showing in pricing label
- Pricing: Fix for hourly plan inconsistency
- Pricing: Fix for changes in machine configuration not being recorded in billing
- Provisioning: Fix for Windows VM turning status green prematurely
- Provisioning: Fix for Google Windows provisioning issue
- Reporting: Fix for cost reports incorrect currency conversion
- Reporting: Fix for mislabeling cost reports
- SAML: Fix for log out page error when integrated with SAML
- Scale: Fix for scale priority under threshold not working as expected
- SCVMM: Fix for SCVMM provisioning failing during failover cluster setup
- SCVMM: Fix for cloud not syncing storage
- Storage: Fix for storage showing wrong datastore
- VCD: Fix for issue with large number of templates and API
- VCD: Fix for |morpheus| triggering a power off instead of graceful shutdown for vApps
- vCD: Fix for vCD guest customization running after instance restart
- VCD: Fix for wrong vCenter showing when editing cloud configuration
- VCD: Fix for Windows instances appearing as discovered when provisioned onto VC
- VCD: Fix for discovered & converted VM's not creating an instance type
- VCD: Fix for custom instance type not shown for VCD clouds
- VCD: Fix for vmId and vappId needing to be swapped
- VCD: Fix for VM computer name/hostname truncated with container ID
- VCD: Fix for Windows instances not syspreped
- vCloud: Fix for cloud-init iso files being left in media
- Veeam: Fix for removing existing job removing wrong job
- Veeam: Fix for Actions -> Backup on an instance executes the entire job rather than backup for itself
- VIO:  Fix for not being able to delete instance, remaining in deleting state when load balancer attached
- Virtual Machines: Fix for external_id not showing for unmanaged instances in UI
- VMware: Fix for thick template disk not respecting cloud setting
- VMware: Fix for additional disks using SCSI 0:7
- VMware: Fix for number of vmdks showing for vSphere 6.5
- VMware: Fix for changing cluster effecting sync
- VMware: Fix for reconfigure deleting snapshots
- VMware: Fix for user not being created with cloudbase-init
